
package com.example.repository;

import java.io.InputStreamReader;
import java.util.Map;
import java.util.ResourceBundle;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.core.io.DefaultResourceLoader;
import org.springframework.core.io.Resource;
import org.springframework.stereotype.Repository;
import org.yaml.snakeyaml.Yaml;

import com.example.domain.IssueInfo;

@Repository
public class IssueInfoRepository {
	
	@Autowired
	IssueInfo issueInfo;
	
	public IssueInfo getIssueInfo(
    		String linkedIssueKey
    		)
    {
		
		DefaultResourceLoader resourceLoader;
		InputStreamReader reader;
		
		
		// load config file
		resourceLoader = new DefaultResourceLoader();
		Resource resource = resourceLoader.getResource("classpath:config.yml");
		reader = new InputStreamReader(resource.getInputStream());
		
		Yaml yaml = new Yaml();
		Map<String,Object> config = (Map)yaml.load(reader);
		
		Map<String,Object> common = config.get("common");
		Map<String,Object> particular = config.get("particular");
				
				
		// set common parameter
		issueInfo.setBaseUri( config.getString("baseUri").toString() );
		issueInfo.setUserId( config.getString("userId").toString() );
		issueInfo.setPassword( config.getString("password").toString() );
		
		// set particular parameter
		issueInfo.setProjectKey( config.getString("projectKey").toString() );
		issueInfo.setIssueTypeId( config.getString("issueTypeId").toString() );
		issueInfo.setSummary( config.getString("summary").toString() + linkedIssueKey );
		issueInfo.setLinkedIssueKey(linkedIssueKey);
	    	
		System.out.println(issueInfo);
			
    	return issueInfo;
    	
    }
	
}
