
package com.example.repository;

import java.util.Map;
import java.util.ResourceBundle;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Repository;
import org.yaml.snakeyaml.Yaml;

import com.example.domain.IssueInfo;

@Repository
public class IssueInfoRepository {
	
	@Autowired
	IssueInfo issueInfo;
	
	public IssueInfo getIssueInfo(
    		String linkedIssueKey
    		)
    {
		
		// load config file
		Yaml yaml = new Yaml();
		System.out.println("config.yamlを読み込みます");
				
		ResourceBundle config = ResourceBundle.getBundle("config");
			
		// Map<String,?> config = (Map)yaml.load(ClassLoader.getSystemResourceAsStream("config/config.yaml"));
		// Map<String,?> common = (Map)((Map)config.get("setting")).get("common");
		// Map<String,?> particular = (Map)((Map)config.get("setting")).get("particular");
		
		// set common parameter
		issueInfo.setBaseUri( config.getString("baseUri").toString() );
		issueInfo.setUserId( config.getString("userId").toString() );
		issueInfo.setPassword( config.getString("password").toString() );
		
		// set particular parameter
		issueInfo.setProjectKey( config.getString("projectKey").toString() );
		issueInfo.setIssueTypeId( config.getString("issueTypeId").toString() );
		issueInfo.setSummary( config.getString("summary").toString() + linkedIssueKey );
		issueInfo.setLinkedIssueKey(linkedIssueKey);
    	
		System.out.println(issueInfo);
		
    	return issueInfo;
    	
    }
	
}
